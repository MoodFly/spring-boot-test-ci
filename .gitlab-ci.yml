default:
  image: 'maven:latest'

stages:
  - prepare
  - test
  - deploy

prepare:
  stage: prepare
  cache:
    key: m_m2
    paths:
      - .m2/repository/
  script:
    - mvn -v && java -version
    - mvn clean install -P skipTests -s settings.xml
  tags:
    - SHARE_MAVEN_JDK

tests:
  stage: test
  cache:
    key: m_m2
    policy: pull
    paths:
      - .m2/repository/
  script:
    - mvn clean install -P tests -s settings.xml
  tags:
    - SHARE_MAVEN_JDK